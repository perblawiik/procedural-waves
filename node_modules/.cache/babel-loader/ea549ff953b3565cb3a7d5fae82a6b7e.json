{"ast":null,"code":"import Transform from './Transform';\nimport Vector3 from \"./math/Vector3\";\nimport Raycast from \"./Raycast\"; // TODO: Linear interpolation for transforms (translation and rotation)\n// TODO: Implement visible and interactable local coordinate system for handling game objects in the editor\n// TODO: Implement a RigidBody component for handling velocity, acceleration and mass\n// TODO: Implement a Collider component for handling collision between game objects\n// TODO: Implement a Material component for handling color, textures, etc.\n// TODO: Implement a Script component for game object logic\n\nclass GameObject {\n  constructor(name) {\n    this.nameTag = name;\n    this.meshes = [];\n    this.transform = new Transform();\n    this.collider = null;\n    this.rigidBody = null;\n    this.isActive = false;\n  }\n\n  get worldPosition() {\n    return new Vector3([this.transform.matrix[12], this.transform.matrix[13], this.transform.matrix[14]]);\n  }\n\n  setNameTag(name) {\n    this.nameTag = name;\n  }\n\n  translate(val) {\n    this.transform.translate(val);\n  }\n\n  rotate(rot) {\n    this.transform.rotate(rot);\n  }\n\n  setPosition(pos) {\n    this.transform.setPosition(pos);\n  }\n\n  setRotation(rot) {\n    this.transform.setRotation(rot);\n  }\n\n  setScale(scale) {\n    this.transform.setScale(scale);\n  }\n\n  setActive(state) {\n    this.isActive = state;\n\n    if (this.collider !== null) {\n      this.collider.setVisible(state);\n    }\n  }\n\n  addMesh(mesh) {\n    this.transform.addChild(mesh.transform);\n    this.meshes.push(mesh);\n  }\n\n  addCollider(collider) {\n    this.transform.addChild(collider.transform);\n    this.collider = collider;\n  }\n\n  addRigidBody(rigidBody) {\n    this.rigidBody = rigidBody;\n  }\n\n  render(shader) {\n    for (let i = 0; i < this.meshes.length; ++i) {\n      this.meshes[i].render(shader);\n    }\n  }\n\n  update(timeStep) {\n    if (this.rigidBody) {\n      if (this.collider) {\n        if (this.rigidBody.velocity.magnitude < 1.0) return;\n        this.rigidBody.update(timeStep);\n        let plane = {\n          normal: new Vector3([0.0, 1.0, 0.0]),\n          offset: 0.0\n        };\n        let rayDir = this.rigidBody.velocity.normalized();\n        let rayOrigin = this.rigidBody.position.clone();\n        let intersectionPoint = Raycast.planeIntersectionTest(rayDir, rayOrigin, plane);\n\n        if (intersectionPoint !== null) {\n          if (Vector3.distance(intersectionPoint, this.collider.worldPosition) < this.collider.radius * 2.0) {\n            let reflectDirection = Vector3.subtract(plane.normal.clone().multipleBy(2.0 * Vector3.dot(plane.normal, rayDir)), rayDir);\n            let bounce = -this.rigidBody.velocity.magnitude * 0.75;\n            this.rigidBody.setVelocity([reflectDirection.x * bounce, reflectDirection.y * bounce, reflectDirection.z * bounce]);\n          }\n        }\n\n        this.transform.setPosition([this.rigidBody.position.x, this.rigidBody.position.y, this.rigidBody.position.z]);\n      } else {\n        this.rigidBody.update(timeStep);\n        this.transform.setPosition([this.rigidBody.position.x, this.rigidBody.position.y, this.rigidBody.position.z]);\n      }\n    }\n\n    this.customUpdate(timeStep);\n  }\n\n  customUpdate(timeStep) {}\n\n}\n\nexport default GameObject;","map":{"version":3,"sources":["G:\\DOKUMENT\\Projekt\\React\\BlueBox\\client\\src\\js\\bluebox\\GameObject.js"],"names":["Transform","Vector3","Raycast","GameObject","constructor","name","nameTag","meshes","transform","collider","rigidBody","isActive","worldPosition","matrix","setNameTag","translate","val","rotate","rot","setPosition","pos","setRotation","setScale","scale","setActive","state","setVisible","addMesh","mesh","addChild","push","addCollider","addRigidBody","render","shader","i","length","update","timeStep","velocity","magnitude","plane","normal","offset","rayDir","normalized","rayOrigin","position","clone","intersectionPoint","planeIntersectionTest","distance","radius","reflectDirection","subtract","multipleBy","dot","bounce","setVelocity","x","y","z","customUpdate"],"mappings":"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","sourcesContent":["import Transform from './Transform';\r\nimport Vector3 from \"./math/Vector3\";\r\nimport Raycast from \"./Raycast\";\r\n\r\n// TODO: Linear interpolation for transforms (translation and rotation)\r\n// TODO: Implement visible and interactable local coordinate system for handling game objects in the editor\r\n// TODO: Implement a RigidBody component for handling velocity, acceleration and mass\r\n// TODO: Implement a Collider component for handling collision between game objects\r\n// TODO: Implement a Material component for handling color, textures, etc.\r\n// TODO: Implement a Script component for game object logic\r\n\r\nclass GameObject {\r\n    constructor (name) {\r\n        this.nameTag = name;\r\n        this.meshes = [];\r\n        this.transform = new Transform();\r\n        this.collider = null;\r\n        this.rigidBody = null;\r\n        this.isActive = false;\r\n    }\r\n\r\n    get worldPosition() {\r\n        return new Vector3([this.transform.matrix[12], this.transform.matrix[13], this.transform.matrix[14]]);\r\n    }\r\n\r\n    setNameTag(name) {\r\n        this.nameTag = name;\r\n    }\r\n\r\n    translate (val) {\r\n        this.transform.translate(val);\r\n    }\r\n\r\n    rotate(rot) {\r\n        this.transform.rotate(rot);\r\n    }\r\n\r\n    setPosition(pos) {\r\n        this.transform.setPosition(pos);\r\n    }\r\n\r\n    setRotation(rot) {\r\n        this.transform.setRotation(rot);\r\n    }\r\n\r\n    setScale(scale) {\r\n        this.transform.setScale(scale);\r\n    }\r\n\r\n    setActive(state) {\r\n        this.isActive = state;\r\n\r\n        if (this.collider !== null) {\r\n            this.collider.setVisible(state);\r\n        }\r\n    }\r\n\r\n    addMesh (mesh) {\r\n        this.transform.addChild(mesh.transform);\r\n        this.meshes.push(mesh);\r\n    }\r\n\r\n    addCollider (collider) {\r\n        this.transform.addChild(collider.transform);\r\n        this.collider = collider;\r\n    }\r\n\r\n    addRigidBody (rigidBody) {\r\n        this.rigidBody = rigidBody;\r\n    }\r\n\r\n    render(shader) {\r\n        for (let i = 0; i < this.meshes.length; ++i) {\r\n            this.meshes[i].render(shader);\r\n        }\r\n    }\r\n\r\n    update(timeStep) {\r\n        if (this.rigidBody) {\r\n            if (this.collider) {\r\n                if (this.rigidBody.velocity.magnitude < 1.0)\r\n                    return;\r\n\r\n                this.rigidBody.update(timeStep);\r\n\r\n                let plane = {\r\n                    normal: new Vector3([0.0, 1.0, 0.0]),\r\n                    offset: 0.0\r\n                };\r\n\r\n                let rayDir = this.rigidBody.velocity.normalized();\r\n                let rayOrigin = this.rigidBody.position.clone();\r\n\r\n                let intersectionPoint = Raycast.planeIntersectionTest(rayDir, rayOrigin, plane);\r\n                if (intersectionPoint !== null) {\r\n                    if (Vector3.distance(intersectionPoint, this.collider.worldPosition) < this.collider.radius*2.0) {\r\n\r\n                        let reflectDirection = Vector3.subtract(plane.normal.clone().multipleBy(2.0 * Vector3.dot(plane.normal, rayDir)), rayDir);\r\n                        let bounce = -this.rigidBody.velocity.magnitude*0.75;\r\n\r\n                        this.rigidBody.setVelocity([\r\n                            reflectDirection.x*bounce,\r\n                            reflectDirection.y*bounce,\r\n                            reflectDirection.z*bounce\r\n                        ]);\r\n                    }\r\n                }\r\n\r\n                this.transform.setPosition([this.rigidBody.position.x, this.rigidBody.position.y, this.rigidBody.position.z]);\r\n            }\r\n            else {\r\n                this.rigidBody.update(timeStep);\r\n                this.transform.setPosition([this.rigidBody.position.x, this.rigidBody.position.y, this.rigidBody.position.z]);\r\n            }\r\n        }\r\n\r\n        this.customUpdate(timeStep);\r\n    }\r\n\r\n    customUpdate(timeStep) {\r\n\r\n    }\r\n}\r\n\r\nexport default GameObject;"]},"metadata":{},"sourceType":"module"}