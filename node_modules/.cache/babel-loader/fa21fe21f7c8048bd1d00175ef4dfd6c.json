{"ast":null,"code":"import Time from \"./Time\";\nimport MouseEvent from \"./events/MouseEvent\";\nimport Raycast from \"./Raycast\";\nimport Mesh from \"./Mesh\";\nimport Matrix4 from \"./math/Matrix4\";\n\nclass GameEditor {\n  constructor(gl, context2D, shaders, camera, canvas) {\n    this.gl = gl;\n    this.context2D = context2D;\n    this.canvas = canvas;\n    this.shaders = shaders;\n    this.camera = camera;\n    this.projectionMatrix = Matrix4.identity();\n    this.selectedObject = null; // Initialize timing variables\n\n    this.lastTime = 0.0;\n    this.frameCount = 0;\n    this.fps = 0;\n    this.currentTextOffset = 0; // Create a 3D model used for visualizing the sphere collider\n\n    this.sphereColliderModel = new Mesh(this.gl);\n    this.sphereColliderModel.createSphere(6);\n    this.sphereColliderModel.setColor([0.75, 0.75, 0.75]);\n    this.sphereColliderModel.setDrawMode(this.gl.LINE_STRIP);\n    this.intersectableObjects = [];\n  }\n\n  addIntersectableObject(gameObject) {\n    this.intersectableObjects.push(gameObject);\n  }\n\n  render(scenes) {\n    // Draw collider editor models\n    this.gl.disable(this.gl.DEPTH_TEST);\n    scenes.forEach(scene => {\n      scene.drawColliders(this.sphereColliderModel);\n    });\n    this.drawTextElements();\n  }\n\n  processUserInput() {\n    // Handle camera navigation\n    this.processCameraNavigation(); // If left mouse button is pressed, cast a ray from the mouse cursor position\n\n    if (MouseEvent.mouseDown && MouseEvent.isPressed.leftButton) {\n      // Create a ray from the camera\n      let ray = Raycast.raycastFromMouseCursor(MouseEvent.offsetX, MouseEvent.offsetY, this.camera.transform, this.projectionMatrix, this.canvas.width, this.canvas.height); //// Test ray intersections ////\n\n      let objectFound = this.findObjectIntersection(ray);\n\n      if (objectFound) {\n        if (this.selectedObject) this.selectedObject.setActive(false);\n        objectFound.setActive(true);\n        this.selectedObject = objectFound;\n      }\n    }\n  }\n\n  processCameraNavigation() {\n    // Zoom camera view in and out\n    if (MouseEvent.isPressed.middleButton) {\n      this.camera.translate([0.0, 0.0, -(MouseEvent.movementY + MouseEvent.movementX) / 20.0]);\n    } // Pan the camera view\n    else if (MouseEvent.isPressed.leftButton) {\n        this.camera.translate([-MouseEvent.movementX / 40.0, MouseEvent.movementY / 40.0, 0.0]);\n      } // Rotate the camera view\n      else if (MouseEvent.isPressed.rightButton) {\n          this.camera.rotate([-MouseEvent.movementY / 10.0, -MouseEvent.movementX / 10.0, 0.0]);\n        }\n\n    if (Math.abs(MouseEvent.wheelDelta) > 0.01) {\n      if (MouseEvent.wheelDelta > 0.0) {\n        this.camera.translate([0.0, 0.0, 0.5]);\n      } else this.camera.translate([0.0, 0.0, -0.5]);\n    }\n  }\n\n  drawTextElements() {\n    // Set text font style\n    this.context2D.font = \"20px Consolas\";\n    this.context2D.fillStyle = 'white';\n    this.currentTextOffset = 0; // Clear previous\n\n    this.context2D.clearRect(this.currentTextOffset, 0, this.canvas.offsetWidth, 30); // Draw the text\n\n    this.displayFrameRate();\n    this.displayCameraPosition();\n  }\n\n  displayFrameRate() {\n    let currentTime = Time.time; // If tNow - tLast >= 1000, one second has passed\n\n    if (currentTime - this.lastTime >= 1000.0) {\n      // Fps = the number of frames\n      this.fps = this.frameCount; // Update timer\n\n      this.lastTime = currentTime; // Reset frame count\n\n      this.frameCount = 0;\n    } else {\n      ++this.frameCount;\n    } // Compose text string\n\n\n    let fpsText = \"Frame rate: \" + this.fps + \" fps, Time per frame: \" + Time.deltaTime.toFixed(0) + \" ms,\"; // Draw fps and frame time in milliseconds\n\n    this.context2D.fillText(fpsText, 10, 25); // Update text offset for next text\n\n    this.currentTextOffset = fpsText.length * 12 + 10;\n  }\n\n  displayCameraPosition() {\n    let pos = this.camera.transform.position; // Compose text string\n\n    let cameraPositionText = \"Camera position: (\" + pos.x.toFixed(2) + \", \" + pos.y.toFixed(2) + \", \" + pos.z.toFixed(2) + \")\"; // Draw fps and frame time in milliseconds\n\n    this.context2D.fillText(cameraPositionText, this.currentTextOffset, 25); // Update text offset for next text\n\n    this.currentTextOffset = cameraPositionText.length * 12;\n  }\n\n  findObjectIntersection(ray) {\n    let objectFound = null;\n    let closestHit = 0;\n    this.intersectableObjects.forEach(object => {\n      let t = Raycast.sphereIntersectionTest(ray, object.collider);\n\n      if (t > closestHit) {\n        objectFound = object;\n        closestHit = t;\n      }\n    });\n    return objectFound;\n  }\n\n}\n\nexport default GameEditor;","map":{"version":3,"sources":["G:\\DOKUMENT\\Projekt\\React\\BlueBox\\client\\src\\js\\bluebox\\GameEditor.js"],"names":["Time","MouseEvent","Raycast","Mesh","Matrix4","GameEditor","constructor","gl","context2D","shaders","camera","canvas","projectionMatrix","identity","selectedObject","lastTime","frameCount","fps","currentTextOffset","sphereColliderModel","createSphere","setColor","setDrawMode","LINE_STRIP","intersectableObjects","addIntersectableObject","gameObject","push","render","scenes","disable","DEPTH_TEST","forEach","scene","drawColliders","drawTextElements","processUserInput","processCameraNavigation","mouseDown","isPressed","leftButton","ray","raycastFromMouseCursor","offsetX","offsetY","transform","width","height","objectFound","findObjectIntersection","setActive","middleButton","translate","movementY","movementX","rightButton","rotate","Math","abs","wheelDelta","font","fillStyle","clearRect","offsetWidth","displayFrameRate","displayCameraPosition","currentTime","time","fpsText","deltaTime","toFixed","fillText","length","pos","position","cameraPositionText","x","y","z","closestHit","object","t","sphereIntersectionTest","collider"],"mappings":"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","sourcesContent":["import Time from \"./Time\";\r\nimport MouseEvent from \"./events/MouseEvent\";\r\nimport Raycast from \"./Raycast\";\r\nimport Mesh from \"./Mesh\";\r\nimport Matrix4 from \"./math/Matrix4\";\r\n\r\nclass GameEditor {\r\n    constructor(gl, context2D, shaders, camera, canvas) {\r\n        this.gl = gl;\r\n        this.context2D = context2D;\r\n        this.canvas = canvas;\r\n\r\n        this.shaders = shaders;\r\n        this.camera = camera;\r\n        this.projectionMatrix = Matrix4.identity();\r\n        this.selectedObject = null;\r\n\r\n        // Initialize timing variables\r\n        this.lastTime = 0.0;\r\n        this.frameCount = 0;\r\n        this.fps = 0;\r\n        this.currentTextOffset = 0;\r\n\r\n        // Create a 3D model used for visualizing the sphere collider\r\n        this.sphereColliderModel = new Mesh(this.gl);\r\n        this.sphereColliderModel.createSphere(6);\r\n        this.sphereColliderModel.setColor([0.75, 0.75, 0.75]);\r\n        this.sphereColliderModel.setDrawMode(this.gl.LINE_STRIP);\r\n\r\n        this.intersectableObjects = [];\r\n    }\r\n\r\n    addIntersectableObject(gameObject) {\r\n        this.intersectableObjects.push(gameObject);\r\n    }\r\n\r\n    render(scenes) {\r\n        // Draw collider editor models\r\n        this.gl.disable(this.gl.DEPTH_TEST);\r\n        scenes.forEach((scene) => {\r\n            scene.drawColliders(this.sphereColliderModel);\r\n        });\r\n\r\n        this.drawTextElements();\r\n    }\r\n\r\n    processUserInput() {\r\n        // Handle camera navigation\r\n        this.processCameraNavigation();\r\n\r\n        // If left mouse button is pressed, cast a ray from the mouse cursor position\r\n        if(MouseEvent.mouseDown && MouseEvent.isPressed.leftButton) {\r\n            // Create a ray from the camera\r\n            let ray = Raycast.raycastFromMouseCursor(MouseEvent.offsetX, MouseEvent.offsetY, this.camera.transform, this.projectionMatrix, this.canvas.width, this.canvas.height);\r\n\r\n            //// Test ray intersections ////\r\n            let objectFound = this.findObjectIntersection(ray);\r\n            if (objectFound) {\r\n                if (this.selectedObject)\r\n                    this.selectedObject.setActive(false);\r\n\r\n                objectFound.setActive(true);\r\n                this.selectedObject = objectFound;\r\n            }\r\n        }\r\n    }\r\n\r\n    processCameraNavigation () {\r\n        // Zoom camera view in and out\r\n        if (MouseEvent.isPressed.middleButton) {\r\n            this.camera.translate([0.0, 0.0, -(MouseEvent.movementY + MouseEvent.movementX)/20.0]);\r\n        } // Pan the camera view\r\n        else if(MouseEvent.isPressed.leftButton) {\r\n            this.camera.translate([-MouseEvent.movementX/40.0, MouseEvent.movementY/40.0, 0.0]);\r\n        } // Rotate the camera view\r\n        else if (MouseEvent.isPressed.rightButton) {\r\n            this.camera.rotate([-MouseEvent.movementY/10.0, -MouseEvent.movementX/10.0, 0.0]);\r\n        }\r\n\r\n        if (Math.abs(MouseEvent.wheelDelta) > 0.01) {\r\n            if (MouseEvent.wheelDelta > 0.0) {\r\n                this.camera.translate([0.0, 0.0, 0.5]);\r\n            }\r\n            else\r\n                this.camera.translate([0.0, 0.0, -0.5]);\r\n        }\r\n    }\r\n\r\n    drawTextElements() {\r\n        // Set text font style\r\n        this.context2D.font = \"20px Consolas\";\r\n        this.context2D.fillStyle = 'white';\r\n        this.currentTextOffset = 0;\r\n\r\n        // Clear previous\r\n        this.context2D.clearRect(this.currentTextOffset, 0, this.canvas.offsetWidth, 30);\r\n\r\n        // Draw the text\r\n        this.displayFrameRate();\r\n        this.displayCameraPosition();\r\n    }\r\n\r\n    displayFrameRate() {\r\n        let currentTime = Time.time;\r\n        // If tNow - tLast >= 1000, one second has passed\r\n        if ((currentTime - this.lastTime) >= 1000.0) {\r\n            // Fps = the number of frames\r\n            this.fps = this.frameCount;\r\n            // Update timer\r\n            this.lastTime = currentTime;\r\n            // Reset frame count\r\n            this.frameCount = 0;\r\n        }\r\n        else {\r\n            ++this.frameCount;\r\n        }\r\n\r\n        // Compose text string\r\n        let fpsText = \"Frame rate: \" + this.fps + \" fps, Time per frame: \" + Time.deltaTime.toFixed(0) + \" ms,\";\r\n        // Draw fps and frame time in milliseconds\r\n        this.context2D.fillText(fpsText, 10, 25);\r\n        // Update text offset for next text\r\n        this.currentTextOffset = fpsText.length * 12 + 10;\r\n    }\r\n\r\n    displayCameraPosition() {\r\n        let pos = this.camera.transform.position;\r\n        // Compose text string\r\n        let cameraPositionText = \"Camera position: (\" + pos.x.toFixed(2) + \", \" + pos.y.toFixed(2) + \", \" + pos.z.toFixed(2) + \")\";\r\n\r\n        // Draw fps and frame time in milliseconds\r\n        this.context2D.fillText(cameraPositionText, this.currentTextOffset, 25);\r\n        // Update text offset for next text\r\n        this.currentTextOffset = cameraPositionText.length * 12;\r\n    }\r\n\r\n    findObjectIntersection(ray) {\r\n        let objectFound = null;\r\n\r\n        let closestHit = 0;\r\n        this.intersectableObjects.forEach((object) => {\r\n            let t = Raycast.sphereIntersectionTest(ray, object.collider);\r\n            if (t > closestHit) {\r\n                objectFound = object;\r\n                closestHit = t;\r\n            }\r\n        });\r\n\r\n        return objectFound;\r\n    }\r\n}\r\n\r\nexport default GameEditor;"]},"metadata":{},"sourceType":"module"}