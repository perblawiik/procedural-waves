{"ast":null,"code":"//TODO: Implement Quaternion for handling rotations\nimport Matrix4 from './math/Matrix4';\nimport Vector3 from './math/Vector3';\n\nclass Transform {\n  constructor() {\n    this.position = new Vector3([0.0, 0.0, 0.0]);\n    this.rotation = new Vector3([0.0, 0.0, 0.0]);\n    this.scaling = new Vector3([1.0, 1.0, 1.0]);\n    this.matrix = Matrix4.identity();\n    this.localMatrix = Matrix4.identity();\n    this.customRotation = new Vector3([1.0, 0.0, 0.0]);\n    this.customRotationRad = 0.0;\n    this.parent = null;\n    this.children = [];\n  }\n\n  get xAxis() {\n    return new Vector3([this.matrix[0], this.matrix[4], this.matrix[8]]);\n  }\n\n  setScale(scale) {\n    this.scaling.set(scale);\n    this.composeMatrix();\n    this.updateChildrenTransforms();\n  }\n\n  setPosition(position) {\n    this.position.set(position);\n    this.composeMatrix();\n    this.updateChildrenTransforms();\n  }\n\n  setRotation(rotation) {\n    this.rotation.set(rotation);\n    this.composeMatrix();\n    this.updateChildrenTransforms();\n  }\n\n  translate(val) {\n    let rightVec = new Vector3([this.localMatrix[0] * val[0], this.localMatrix[4] * val[0], this.localMatrix[8] * val[0]]);\n    let upVec = new Vector3([this.localMatrix[1] * val[1], this.localMatrix[5] * val[1], this.localMatrix[9] * val[1]]);\n    let forwardVec = new Vector3([this.localMatrix[2] * val[2], this.localMatrix[6] * val[2], this.localMatrix[10] * val[2]]);\n    this.setPosition([this.position.x + rightVec.x / this.scaling.x - upVec.x / this.scaling.x - forwardVec.x / this.scaling.x, this.position.y - rightVec.y / this.scaling.y + upVec.y / this.scaling.y - forwardVec.y / this.scaling.y, this.position.z - rightVec.z / this.scaling.z - upVec.z / this.scaling.z + forwardVec.z / this.scaling.z]);\n  }\n\n  rotate(rot) {\n    this.setRotation([this.rotation.x + rot[0], this.rotation.y + rot[1], this.rotation.z + rot[2]]);\n  }\n\n  setAxisRotation(axis, angle) {\n    this.customRotation.set(axis);\n    this.customRotationRad = Math.PI * angle / 180.0;\n    Matrix4.rotate(this.matrix, this.matrix, this.customRotationRad, this.customRotation);\n    this.updateChildrenTransforms();\n  }\n\n  setParent(parentTransform) {\n    this.parent = parentTransform;\n    this.matrix = Matrix4.multiply(this.parent.matrix, this.localMatrix);\n    this.updateChildrenTransforms();\n  }\n\n  removeParent() {\n    this.parent = null;\n    this.composeMatrix();\n  }\n\n  addChild(child) {\n    this.children.push(child);\n    child.setParent(this);\n  }\n\n  invert() {\n    return Matrix4.invert(this.matrix, this.matrix);\n  }\n\n  composeMatrix() {\n    let scaleMatrix = Matrix4.scaling(this.scaling.x, this.scaling.y, this.scaling.z);\n    let rotationMatrix = Matrix4.rotateZ(Matrix4.identity(), this.rotation.z * Math.PI / 180);\n    rotationMatrix = Matrix4.rotateX(rotationMatrix, this.rotation.x * Math.PI / 180);\n    rotationMatrix = Matrix4.rotateY(rotationMatrix, this.rotation.y * Math.PI / 180);\n    let translationMatrix = Matrix4.translation(this.position.x, this.position.y, this.position.z);\n    this.localMatrix = Matrix4.multiply(rotationMatrix, scaleMatrix);\n    this.localMatrix = Matrix4.multiply(translationMatrix, this.localMatrix);\n    if (this.parent) this.matrix = Matrix4.multiply(this.parent.matrix, this.localMatrix);else this.matrix = this.localMatrix;\n  }\n\n  updateChildrenTransforms() {\n    for (let i = 0; i < this.children.length; ++i) {\n      this.children[i].setParent(this);\n    }\n  }\n\n}\n\nexport default Transform;","map":{"version":3,"sources":["G:\\DOKUMENT\\Projekt\\React\\BlueBox\\client\\src\\js\\bluebox\\Transform.js"],"names":["Matrix4","Vector3","Transform","constructor","position","rotation","scaling","matrix","identity","localMatrix","customRotation","customRotationRad","parent","children","xAxis","setScale","scale","set","composeMatrix","updateChildrenTransforms","setPosition","setRotation","translate","val","rightVec","upVec","forwardVec","x","y","z","rotate","rot","setAxisRotation","axis","angle","Math","PI","setParent","parentTransform","multiply","removeParent","addChild","child","push","invert","scaleMatrix","rotationMatrix","rotateZ","rotateX","rotateY","translationMatrix","translation","i","length"],"mappings":"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","sourcesContent":["//TODO: Implement Quaternion for handling rotations\r\n\r\nimport Matrix4 from './math/Matrix4';\r\nimport Vector3 from './math/Vector3';\r\n\r\nclass Transform {\r\n    constructor() {\r\n        this.position = new Vector3([0.0, 0.0, 0.0]);\r\n        this.rotation = new Vector3([0.0, 0.0, 0.0]);\r\n        this.scaling = new Vector3([1.0, 1.0, 1.0]);\r\n\r\n        this.matrix = Matrix4.identity();\r\n        this.localMatrix = Matrix4.identity();\r\n\r\n        this.customRotation = new Vector3([1.0, 0.0, 0.0]);\r\n        this.customRotationRad = 0.0;\r\n\r\n        this.parent = null;\r\n        this.children = [];\r\n    }\r\n\r\n    get xAxis() {\r\n        return new Vector3([this.matrix[0], this.matrix[4], this.matrix[8]]);\r\n    }\r\n\r\n    setScale(scale) {\r\n        this.scaling.set(scale);\r\n        this.composeMatrix();\r\n\r\n        this.updateChildrenTransforms();\r\n    }\r\n\r\n    setPosition(position) {\r\n        this.position.set(position);\r\n        this.composeMatrix();\r\n\r\n        this.updateChildrenTransforms();\r\n    }\r\n\r\n    setRotation (rotation) {\r\n        this.rotation.set(rotation);\r\n        this.composeMatrix();\r\n\r\n        this.updateChildrenTransforms();\r\n    }\r\n\r\n    translate(val) {\r\n        let rightVec = new Vector3([this.localMatrix[0]*val[0], this.localMatrix[4]*val[0], this.localMatrix[8]*val[0]]);\r\n        let upVec = new Vector3([this.localMatrix[1]*val[1], this.localMatrix[5]*val[1], this.localMatrix[9]*val[1]]);\r\n        let forwardVec = new Vector3([this.localMatrix[2]*val[2], this.localMatrix[6]*val[2], this.localMatrix[10]*val[2]]);\r\n\r\n        this.setPosition([\r\n            this.position.x + rightVec.x/this.scaling.x - upVec.x/this.scaling.x - forwardVec.x/this.scaling.x,\r\n            this.position.y - rightVec.y/this.scaling.y + upVec.y/this.scaling.y - forwardVec.y/this.scaling.y,\r\n            this.position.z - rightVec.z/this.scaling.z - upVec.z/this.scaling.z + forwardVec.z/this.scaling.z,\r\n        ]);\r\n    }\r\n\r\n    rotate (rot) {\r\n        this.setRotation([\r\n            this.rotation.x + rot[0],\r\n            this.rotation.y + rot[1],\r\n            this.rotation.z + rot[2]\r\n        ]);\r\n    }\r\n\r\n    setAxisRotation(axis, angle) {\r\n        this.customRotation.set(axis);\r\n        this.customRotationRad = (Math.PI * angle) / 180.0;\r\n        \r\n        Matrix4.rotate(this.matrix, this.matrix, this.customRotationRad, this.customRotation);\r\n        this.updateChildrenTransforms();\r\n    }\r\n\r\n    setParent(parentTransform) {\r\n        this.parent = parentTransform;\r\n        this.matrix = Matrix4.multiply(this.parent.matrix, this.localMatrix);\r\n\r\n        this.updateChildrenTransforms();\r\n    }\r\n\r\n    removeParent() {\r\n        this.parent = null;\r\n        this.composeMatrix();\r\n    }\r\n\r\n    addChild(child) {\r\n        this.children.push(child);\r\n        child.setParent(this);\r\n    }\r\n\r\n    invert () {\r\n        return Matrix4.invert(this.matrix, this.matrix);\r\n    }\r\n\r\n    composeMatrix () {\r\n        let scaleMatrix = Matrix4.scaling(this.scaling.x, this.scaling.y, this.scaling.z);\r\n        let rotationMatrix = Matrix4.rotateZ(Matrix4.identity(), (this.rotation.z*Math.PI/180));\r\n        rotationMatrix = Matrix4.rotateX(rotationMatrix, (this.rotation.x*Math.PI/180));\r\n        rotationMatrix = Matrix4.rotateY(rotationMatrix, (this.rotation.y*Math.PI/180));\r\n\r\n        let translationMatrix = Matrix4.translation(this.position.x, this.position.y, this.position.z);\r\n\r\n        this.localMatrix = Matrix4.multiply(rotationMatrix, scaleMatrix);\r\n        this.localMatrix = Matrix4.multiply(translationMatrix, this.localMatrix);\r\n\r\n        if (this.parent)\r\n            this.matrix = Matrix4.multiply(this.parent.matrix, this.localMatrix);\r\n        else\r\n            this.matrix = this.localMatrix\r\n    }\r\n\r\n    updateChildrenTransforms() {\r\n        for (let i = 0; i < this.children.length; ++i) {\r\n            this.children[i].setParent(this);\r\n        }\r\n    }\r\n}\r\n\r\nexport default Transform;"]},"metadata":{},"sourceType":"module"}