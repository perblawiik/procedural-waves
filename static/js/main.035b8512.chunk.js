(this["webpackJsonpprocedural-waves"]=this["webpackJsonpprocedural-waves"]||[]).push([[0],[,,,,,,,,function(t,e,i){t.exports=i(17)},,,,,function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){"use strict";i.r(e);var n=i(0),a=i.n(n),o=i(7),r=i.n(o),s=(i(13),i(1)),c=i(2),h=i(4),l=i(3),u=i(5),m=(i(14),i(15),function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,null,[{key:"init",value:function(){this._time=window.performance.now(),this._deltaTime=0}},{key:"update",value:function(){this._deltaTime=window.performance.now()-this._time,this._time=window.performance.now()}},{key:"now",get:function(){return window.performance.now()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"time",get:function(){return this._time}}]),t}()),v=function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,null,[{key:"init",value:function(){this.xPos=0,this.yPos=0,this.moveX=0,this.moveY=0,this.wheel=0,this.down=!1,this.up=!1,this.buttonPressed={leftButton:!1,rightButton:!1,middleButton:!1}}},{key:"setOffsetX",value:function(t){this.xPos=t}},{key:"setOffsetY",value:function(t){this.yPos=t}},{key:"setMovementX",value:function(t){this.moveX=t}},{key:"setMovementY",value:function(t){this.moveY=t}},{key:"setMouseDownEvent",value:function(t){this.down=t}},{key:"setMouseUpEvent",value:function(t){this.up=t}},{key:"setWheelDelta",value:function(t){this.wheel=t}},{key:"setButtonPressedLeft",value:function(t){this.buttonPressed.leftButton=t}},{key:"setButtonPressedMiddle",value:function(t){this.buttonPressed.middleButton=t}},{key:"setButtonPressedRight",value:function(t){this.buttonPressed.rightButton=t}},{key:"offsetX",get:function(){return this.xPos}},{key:"offsetY",get:function(){return this.yPos}},{key:"movementX",get:function(){return this.moveX}},{key:"movementY",get:function(){return this.moveY}},{key:"wheelDelta",get:function(){return this.wheel}},{key:"mouseDown",get:function(){return this.down}},{key:"mouseUp",get:function(){return this.up}},{key:"isPressed",get:function(){return this.buttonPressed}}]),t}(),f=function(){function t(e,i,n,a,o){Object(s.a)(this,t),this.gl=e,this.context2D=i,this.canvas=o,this.camera=a,this.lastTime=0,this.frameCount=0,this.fps=0,this.currentTextOffset=0}return Object(c.a)(t,[{key:"render",value:function(t){this.drawTextElements()}},{key:"processUserInput",value:function(){this.processCameraNavigation()}},{key:"processCameraNavigation",value:function(){v.isPressed.middleButton?this.camera.translate([0,0,-(v.movementY+v.movementX)/20]):v.isPressed.leftButton?this.camera.translate([-v.movementX/40,v.movementY/40,0]):v.isPressed.rightButton&&this.camera.rotate([-v.movementY/10,-v.movementX/10,0]),Math.abs(v.wheelDelta)>.01&&(v.wheelDelta>0?this.camera.translate([0,0,2]):this.camera.translate([0,0,-2]))}},{key:"drawTextElements",value:function(){this.context2D.font="20px Consolas",this.context2D.fillStyle="white",this.currentTextOffset=0,this.context2D.clearRect(this.currentTextOffset,0,this.canvas.offsetWidth,30),this.displayFrameRate(),this.displayCameraPosition()}},{key:"displayFrameRate",value:function(){var t=m.time;t-this.lastTime>=1e3?(this.fps=this.frameCount,this.lastTime=t,this.frameCount=0):++this.frameCount;var e="Frame rate: "+this.fps+" fps, Time per frame: "+m.deltaTime.toFixed(0)+" ms,";this.context2D.fillText(e,10,25),this.currentTextOffset=12*e.length+10}},{key:"displayCameraPosition",value:function(){var t=this.camera.transform.position,e="Camera position: ("+t.x.toFixed(2)+", "+t.y.toFixed(2)+", "+t.z.toFixed(2)+")";this.context2D.fillText(e,this.currentTextOffset,25),this.currentTextOffset=12*e.length}}]),t}(),d=1,g=2,p=3,y=function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,null,[{key:"init",value:function(){v.init();var t=document.getElementById("text-canvas");t.onmousedown=function(t){v.setMouseDownEvent(!0),t.which===d&&v.setButtonPressedLeft(!0),t.which===p&&v.setButtonPressedRight(!0),t.which===g&&v.setButtonPressedMiddle(!0)},t.onmouseup=function(t){v.setMouseUpEvent(!0),t.which===d&&v.setButtonPressedLeft(!1),t.which===p&&v.setButtonPressedRight(!1),t.which===g&&v.setButtonPressedMiddle(!1)},t.onmouseleave=function(t){v.setButtonPressedLeft(!1),v.setButtonPressedRight(!1),v.setButtonPressedMiddle(!1)},t.onmousemove=function(t){v.setOffsetX(t.offsetX),v.setOffsetY(t.offsetY),v.setMovementX(t.movementX),v.setMovementY(t.movementY)},t.onwheel=function(t){v.setWheelDelta(t.deltaY)}}},{key:"resetMouseEvents",value:function(){v.setMouseDownEvent(!1),v.setMouseUpEvent(!1),v.setWheelDelta(0),v.setMovementX(0),v.setMovementY(0)}}]),t}(),x=function(){function t(e){Object(s.a)(this,t),this.set(e)}return Object(c.a)(t,[{key:"set",value:function(t){this.v1=t[0],this.v2=t[1],this.v3=t[2]}},{key:"clone",value:function(){return new t([this.x,this.y,this.z])}},{key:"inverted",value:function(){return new t([-this.x,-this.y,-this.z])}},{key:"normalized",value:function(){var e=new t([0,0,0]),i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return i>.001?e.set([this.v1/i,this.v2/i,this.v3/i]):e.set([0,0,0]),e}},{key:"divideBy",value:function(t){return this.v1/=t,this.v2/=t,this.v3/=t,this}},{key:"multipleBy",value:function(t){return this.v1*=t,this.v2*=t,this.v3*=t,this}},{key:"x",get:function(){return this.v1}},{key:"y",get:function(){return this.v2}},{key:"z",get:function(){return this.v3}},{key:"r",get:function(){return this.v1}},{key:"g",get:function(){return this.v2}},{key:"b",get:function(){return this.v3}},{key:"magnitude",get:function(){return Math.sqrt(this.v1*this.v1+this.v2*this.v2+this.v3*this.v3)}}],[{key:"distance",value:function(t,e){return Math.sqrt((e.v1-t.v1)*(e.v1-t.v1)+(e.v2-t.v2)*(e.v2-t.v2)+(e.v3-t.v3)*(e.v3-t.v3))}},{key:"add",value:function(e,i){return new t([e.v1+i.v1,e.v2+i.v2,e.v3+i.v3])}},{key:"subtract",value:function(e,i){return new t([e.v1-i.v1,e.v2-i.v2,e.v3-i.v3])}},{key:"crossProduct",value:function(e,i){return new t([e.y*i.z-e.z*i.y,-(e.x*i.z-e.z*i.x),e.x*i.y-e.y*i.x])}},{key:"dot",value:function(t,e){return t.v1*e.v1+t.v2*e.v2+t.v3*e.v3}},{key:"up",value:function(){return new t([0,1,0])}},{key:"down",value:function(){return new t([0,-1,0])}},{key:"forward",value:function(){return new t([0,0,1])}},{key:"backwards",value:function(){return new t([0,0,-1])}},{key:"left",value:function(){return new t([-1,0,0])}},{key:"right",value:function(){return new t([1,0,0])}}]),t}(),w=function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,null,[{key:"identity",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"translation",value:function(t,e,i){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]}},{key:"scaling",value:function(t,e,i){return[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]}},{key:"compose",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new x([0,0,0]);return[t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,n.x,n.y,n.z,1]}},{key:"rotationX",value:function(t){var e=Math.sin(t),i=Math.cos(t);return[1,0,0,0,0,i,e,0,0,-e,i,0,0,0,0,1]}},{key:"rotationY",value:function(t){var e=Math.sin(t),i=Math.cos(t);return[i,0,-e,0,0,1,0,0,e,0,i,0,0,0,0,1]}},{key:"rotationZ",value:function(t){var e=Math.sin(t),i=Math.cos(t);return[i,e,0,0,-e,i,0,0,0,0,1,0,0,0,0,1]}},{key:"perspective",value:function(t,e,i,n){var a=1/Math.tan(t/2),o=1/(i-n);return[a/e,0,0,0,0,a,0,0,0,0,(n+i)*o,-1,0,0,2*n*i*o,0]}},{key:"translate",value:function(t,e,i,n){return this.multiply(this.translation(e,i,n),t)}},{key:"scale",value:function(t,e,i,n){return this.multiply(this.scaling(e,i,n),t)}},{key:"rotateX",value:function(t,e){return this.multiply(this.rotationX(e),t)}},{key:"rotateY",value:function(t,e){return this.multiply(this.rotationY(e),t)}},{key:"rotateZ",value:function(t,e){return this.multiply(this.rotationZ(e),t)}},{key:"multiplyVector",value:function(t,e){var i=[];return i[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],i[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],i[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],i[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],i}},{key:"multiply",value:function(t,e){for(var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0,a=0;a<16;){for(var o=0;o<4;++o)i[n]=t[o]*e[a]+t[o+4]*e[a+1]+t[o+8]*e[a+2]+t[o+12]*e[a+3],++n;a+=4}return i}},{key:"invert",value:function(t,e){var i=e[0],n=e[1],a=e[2],o=e[3],r=e[4],s=e[5],c=e[6],h=e[7],l=e[8],u=e[9],m=e[10],v=e[11],f=e[12],d=e[13],g=e[14],p=e[15],y=i*s-n*r,x=i*c-a*r,w=i*h-o*r,b=n*c-a*s,k=n*h-o*s,P=a*h-o*c,L=l*d-u*f,E=l*g-m*f,C=l*p-v*f,M=u*g-m*d,T=u*p-v*d,S=m*p-v*g,R=y*S-x*T+w*M+b*C-k*E+P*L;return R?(R=1/R,t[0]=(s*S-c*T+h*M)*R,t[1]=(a*T-n*S-o*M)*R,t[2]=(d*P-g*k+p*b)*R,t[3]=(m*k-u*P-v*b)*R,t[4]=(c*C-r*S-h*E)*R,t[5]=(i*S-a*C+o*E)*R,t[6]=(g*w-f*P-p*x)*R,t[7]=(l*P-m*w+v*x)*R,t[8]=(r*T-s*C+h*L)*R,t[9]=(n*C-i*T-o*L)*R,t[10]=(f*k-d*w+p*y)*R,t[11]=(u*w-l*k-v*y)*R,t[12]=(s*E-r*M-c*L)*R,t[13]=(i*M-n*E+a*L)*R,t[14]=(d*x-f*b-g*y)*R,t[15]=(l*b-u*x+m*y)*R,t):null}},{key:"rotate",value:function(t,e,i,n){var a,o,r,s,c,h,l,u,m,v,f,d,g,p,y,x,w,b,k,P,L,E,C,M,T=n.x,S=n.y,R=n.z,z=Math.sqrt(T*T+S*S+R*R);return Math.abs(z)<.001?null:(T*=z=1/z,S*=z,R*=z,a=Math.sin(i),r=1-(o=Math.cos(i)),s=e[0],c=e[1],h=e[2],l=e[3],u=e[4],m=e[5],v=e[6],f=e[7],d=e[8],g=e[9],p=e[10],y=e[11],x=T*T*r+o,w=S*T*r+R*a,b=R*T*r-S*a,k=T*S*r-R*a,P=S*S*r+o,L=R*S*r+T*a,E=T*R*r+S*a,C=S*R*r-T*a,M=R*R*r+o,t[0]=s*x+u*w+d*b,t[1]=c*x+m*w+g*b,t[2]=h*x+v*w+p*b,t[3]=l*x+f*w+y*b,t[4]=s*k+u*P+d*L,t[5]=c*k+m*P+g*L,t[6]=h*k+v*P+p*L,t[7]=l*k+f*P+y*L,t[8]=s*E+u*C+d*M,t[9]=c*E+m*C+g*M,t[10]=h*E+v*C+p*M,t[11]=l*E+f*C+y*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}}]),t}(),b=function(){function t(){Object(s.a)(this,t),this.position=new x([0,0,0]),this.rotation=new x([0,0,0]),this.scaling=new x([1,1,1]),this.matrix=w.identity(),this.localMatrix=w.identity(),this.customRotation=new x([1,0,0]),this.customRotationRad=0,this.parent=null,this.children=[]}return Object(c.a)(t,[{key:"setScale",value:function(t){this.scaling.set(t),this.composeMatrix(),this.updateChildrenTransforms()}},{key:"setPosition",value:function(t){this.position.set(t),this.composeMatrix(),this.updateChildrenTransforms()}},{key:"setRotation",value:function(t){this.rotation.set(t),this.composeMatrix(),this.updateChildrenTransforms()}},{key:"translate",value:function(t){var e=new x([this.localMatrix[0]*t[0],this.localMatrix[4]*t[0],this.localMatrix[8]*t[0]]),i=new x([this.localMatrix[1]*t[1],this.localMatrix[5]*t[1],this.localMatrix[9]*t[1]]),n=new x([this.localMatrix[2]*t[2],this.localMatrix[6]*t[2],this.localMatrix[10]*t[2]]);this.setPosition([this.position.x+e.x/this.scaling.x-i.x/this.scaling.x-n.x/this.scaling.x,this.position.y-e.y/this.scaling.y+i.y/this.scaling.y-n.y/this.scaling.y,this.position.z-e.z/this.scaling.z-i.z/this.scaling.z+n.z/this.scaling.z])}},{key:"rotate",value:function(t){this.setRotation([this.rotation.x+t[0],this.rotation.y+t[1],this.rotation.z+t[2]])}},{key:"setAxisRotation",value:function(t,e){this.customRotation.set([t.x,t.y,t.z]),this.customRotationRad=Math.PI*e/180,this.composeMatrix(),this.updateChildrenTransforms()}},{key:"setParent",value:function(t){this.parent=t,this.matrix=w.multiply(this.parent.matrix,this.localMatrix),this.updateChildrenTransforms()}},{key:"removeParent",value:function(){this.parent=null,this.composeMatrix()}},{key:"addChild",value:function(t){this.children.push(t),t.setParent(this)}},{key:"invert",value:function(){return w.invert(this.matrix,this.matrix)}},{key:"composeMatrix",value:function(){var t=w.scaling(this.scaling.x,this.scaling.y,this.scaling.z),e=w.rotateZ(w.identity(),this.rotation.z*Math.PI/180);e=w.rotateX(e,this.rotation.x*Math.PI/180),e=w.rotateY(e,this.rotation.y*Math.PI/180),w.rotate(e,e,this.customRotationRad,this.customRotation);var i=w.translation(this.position.x,this.position.y,this.position.z);this.localMatrix=w.multiply(e,t),this.localMatrix=w.multiply(i,this.localMatrix),this.parent?this.matrix=w.multiply(this.parent.matrix,this.localMatrix):this.matrix=this.localMatrix}},{key:"updateChildrenTransforms",value:function(){for(var t=0;t<this.children.length;++t)this.children[t].setParent(this)}},{key:"xAxis",get:function(){return new x([this.matrix[0],this.matrix[4],this.matrix[8]])}}]),t}(),k=function(){function t(e){Object(s.a)(this,t),this.sceneObjects=[],this.lightSources=[],this.shaders=e,this.currentTime=0,this.transform=new b}return Object(c.a)(t,[{key:"setPosition",value:function(t){this.transform.setPosition(t)}},{key:"setRotation",value:function(t){this.transform.setRotation(t)}},{key:"setScale",value:function(t){this.transform.setScale(t)}},{key:"addGameObject",value:function(t){this.transform.addChild(t.transform),this.sceneObjects.push(t)}},{key:"addLightSource",value:function(t){var e=this;this.transform.addChild(t.transform),this.shaders.forEach((function(i){i.activate();var n=e.lightSources.length,a="pointLights["+n+"].",o=i.getUniformLoc(a+"position"),r=i.getUniformLoc(a+"color"),s=i.getUniformLoc(a+"attenuationConstants"),c=i.getUniformLoc("lightCount");i.setUniformVec3f(o,t.worldPosition),i.setUniformVec3f(r,t.lightColor),i.setUniformVec2f(s,[t.attenuationConstants.kLinear,t.attenuationConstants.kQuadratic]),i.setUniformInt(c,n)})),this.lightSources.push(t)}},{key:"updateLightPositions",value:function(){var t=this.shaders.get("phong");t.activate();for(var e=0;e<this.lightSources.length;++e){var i=this.lightSources[e],n=this.lightSources.length,a="pointLights["+e+"].",o=t.getUniformLoc(a+"position"),r=t.getUniformLoc(a+"color"),s=t.getUniformLoc(a+"attenuationConstants"),c=t.getUniformLoc("lightCount");t.setUniformVec3f(o,i.worldPosition),t.setUniformVec3f(r,i.lightColor),t.setUniformVec2f(s,[i.attenuationConstants.kLinear,i.attenuationConstants.kQuadratic]),t.setUniformInt(c,n)}}},{key:"draw",value:function(){var t=this;this.sceneObjects.forEach((function(e){e.render(t.shaders.get(e.shaderName))})),this.lightSources.forEach((function(e){e.render(t.shaders.get("ambient"))}))}},{key:"update",value:function(t){this.currentTime+=t;var e=this.shaders.get("procedural");e.activate();var i=e.getUniformLoc("time");e.setUniformFloat(i,this.currentTime),this.sceneObjects.forEach((function(e){e.update(t)}))}}]),t}(),P=function(){function t(e){Object(s.a)(this,t),this.transform=new b,this.shaders=e,this.updateUniforms()}return Object(c.a)(t,[{key:"translate",value:function(t){var e=new x([this.transform.matrix[0]*t[0],this.transform.matrix[4]*t[0],this.transform.matrix[8]*t[0]]),i=new x([this.transform.matrix[1]*t[1],this.transform.matrix[5]*t[1],this.transform.matrix[9]*t[1]]),n=new x([this.transform.matrix[2]*t[2],this.transform.matrix[6]*t[2],this.transform.matrix[10]*t[2]]);this.setPosition([this.transform.position.x+e.x+i.x+n.x,this.transform.position.y+e.y+i.y+n.y,this.transform.position.z+e.z+i.z+n.z])}},{key:"rotate",value:function(t){this.setRotation([this.transform.rotation.x+t[0],this.transform.rotation.y+t[1],this.transform.rotation.z+t[2]])}},{key:"setPosition",value:function(t){this.transform.setPosition(t),this.transform.invert(),this.updateUniforms()}},{key:"setRotation",value:function(t){this.transform.setRotation(t),this.transform.invert(),this.updateUniforms()}},{key:"rotateX",value:function(t){this.setRotation([t,this.transform.rotation.y,this.transform.rotation.z])}},{key:"rotateY",value:function(t){this.setRotation([this.transform.rotation.x,t,this.transform.rotation.z])}},{key:"updateUniforms",value:function(){var t=this;this.shaders.forEach((function(e){e.activate(),e.setCameraViewUniform(t.transform.matrix),e.setCameraViewPosition(t.transform.position)}))}},{key:"position",get:function(){return this.transform.position}},{key:"rotation",get:function(){return this.transform.rotation}},{key:"scale",get:function(){return this.transform.scaling}},{key:"right",get:function(){return new x([this.transform.matrix[0],this.transform.matrix[4],this.transform.matrix[8]])}},{key:"up",get:function(){return new x([this.transform.matrix[1],this.transform.matrix[5],this.transform.matrix[9]])}},{key:"forward",get:function(){return new x([-this.transform.matrix[2],-this.transform.matrix[6],-this.transform.matrix[10]])}}]),t}(),L=function(){function t(e){Object(s.a)(this,t),this.nameTag=e,this.meshes=[],this.transform=new b,this.shaderName="phong"}return Object(c.a)(t,[{key:"setNameTag",value:function(t){this.nameTag=t}},{key:"translate",value:function(t){this.transform.translate(t)}},{key:"rotate",value:function(t){this.transform.rotate(t)}},{key:"setPosition",value:function(t){this.transform.setPosition(t)}},{key:"setRotation",value:function(t){this.transform.setRotation(t)}},{key:"setScale",value:function(t){this.transform.setScale(t)}},{key:"addMesh",value:function(t){this.transform.addChild(t.transform),this.meshes.push(t)}},{key:"setShader",value:function(t){this.shaderName=t}},{key:"render",value:function(t){for(var e=0;e<this.meshes.length;++e)this.meshes[e].render(t)}},{key:"update",value:function(t){this.customUpdate(t)}},{key:"customUpdate",value:function(t){}},{key:"worldPosition",get:function(){return new x([this.transform.matrix[12],this.transform.matrix[13],this.transform.matrix[14]])}}]),t}(),E=function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,null,[{key:"createCube",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=[-t,-e,-i,0,-1,0,0,1,-t,-e,-i,-1,0,0,0,1,-t,-e,-i,0,0,-1,1,1,-t,-e,i,0,-1,0,0,0,-t,-e,i,0,0,1,0,1,-t,-e,i,-1,0,0,1,1,t,-e,i,0,-1,0,1,0,t,-e,i,0,0,1,1,1,t,-e,i,1,0,0,0,1,t,-e,-i,0,-1,0,1,1,t,-e,-i,0,0,-1,0,1,t,-e,-i,1,0,0,1,1,-t,e,-i,-1,0,0,0,0,-t,e,-i,0,0,-1,1,0,-t,e,-i,0,1,0,0,0,-t,e,i,0,0,1,0,0,-t,e,i,-1,0,0,1,0,-t,e,i,0,1,0,0,1,t,e,i,0,0,1,1,0,t,e,i,1,0,0,0,0,t,e,i,0,1,0,1,1,t,e,-i,0,0,-1,0,0,t,e,-i,1,0,0,1,0,t,e,-i,0,1,0,1,0],a=[0,9,6,6,3,0,4,7,18,18,15,4,1,5,16,16,12,1,2,13,21,21,10,2,8,11,22,22,19,8,14,17,20,20,23,14],o=12,r=3*o;return{numVertices:r,vertices:n,indices:a}}},{key:"createSphere",value:function(t,e){var i=t;i<2&&(i=2);var n=2*i,a=1+(i-1)*n+1,o=n+4*(i-2)*i+n,r=[],s=[];r[0]=0,r[1]=-e,r[2]=0,r[3]=0,r[4]=-1,r[5]=0,r[6]=.5,r[7]=0;for(var c=Math.PI,h=c/i,l=-c+h,u=0,m=7,v=0;v<i-1;++v){var f=Math.cos(l),d=Math.sin(l);u=0;for(var g=0;g<n;++g)r[++m]=e*d*Math.sin(u),r[++m]=e*f,r[++m]=e*d*Math.cos(u),r[++m]=d*Math.sin(u),r[++m]=f,r[++m]=d*Math.cos(u),r[++m]=u/(2*c),r[++m]=1+l/c,u+=h;l+=h}r[++m]=0,r[++m]=e,r[++m]=0,r[++m]=0,r[++m]=1,r[++m]=0,r[++m]=.5,r[++m]=1,m=-1;for(var p=0;p<n;++p)s[++m]=0,s[++m]=p+2<=n?p+2:p+2-n,s[++m]=p+1;for(var y=1,x=0;x<i-2;x++){for(var w=0;w<n-1;++w)s[++m]=y,s[++m]=y+1,s[++m]=n+y,s[++m]=y+1,s[++m]=n+y+1,s[++m]=n+y,++y;s[++m]=y,s[++m]=y+1-n,s[++m]=n+y,s[++m]=y+1-n,s[++m]=y+1,s[++m]=n+y,++y}for(var b=a-1,k=0;k<n;++k)s[++m]=b,s[++m]=b-2-k>=b-n?b-2-k:b-n-1,s[++m]=b-1-k;return s[3*o-2]=b-1,{numVertices:s.length,vertices:r,indices:s}}},{key:"createCylinderSmooth",value:function(t,e,i,n){e<1&&(e=1),t<4&&(t=4);var a=[],o=[];a[0]=0,a[1]=-n/2,a[2]=0,a[3]=0,a[4]=-1,a[5]=0,a[6]=.5,a[7]=.5;for(var r=Math.PI,s=-r,c=0,h=7,l=0;l<t;++l)a[++h]=i*Math.sin(c),a[++h]=-n/2,a[++h]=i*Math.cos(c),a[++h]=0,a[++h]=-1,a[++h]=0,a[++h]=.5*Math.cos(c)+.5,a[++h]=.5*Math.sin(c+r)+.5,c+=2*r/t;c=0;for(var u=0;u<e+1;++u){for(var m=Math.cos(s),v=0;v<t;++v)a[++h]=i*Math.sin(c),a[++h]=n/2*m,a[++h]=i*Math.cos(c),a[++h]=Math.sin(c),a[++h]=m,a[++h]=Math.cos(c),a[++h]=c/(2*r),a[++h]=Math.abs(.5*m-.5),c+=2*r/t;c=0,s+=r/e}c=0;for(var f=0;f<t;++f)a[++h]=i*Math.sin(c),a[++h]=n/2,a[++h]=i*Math.cos(c),a[++h]=0,a[++h]=1,a[++h]=0,a[++h]=.5*Math.cos(c)+.5,a[++h]=.5*Math.sin(c+r)+.5,c+=2*r/t;a[++h]=0,a[++h]=n/2,a[++h]=0,a[++h]=0,a[++h]=1,a[++h]=0,a[++h]=.5,a[++h]=.5,h=-1;for(var d=0;d<t;++d)o[++h]=0,o[++h]=d+2<=t?d+2:d+2-t,o[++h]=d+1;for(var g=t+1,p=0;p<e;p++){for(var y=0;y<t-1;++y)o[++h]=g,o[++h]=g+1,o[++h]=t+g,o[++h]=g+1,o[++h]=t+g+1,o[++h]=t+g,++g;o[++h]=g,o[++h]=g+1-t,o[++h]=t+g,o[++h]=g+1-t,o[++h]=g+1,o[++h]=t+g,++g}for(var x=4*t+2+t*(e-1)-1,w=0;w<t;++w)o[++h]=x,o[++h]=x-2-w>=x-t?x-2-w:x-1,o[++h]=x-1-w;return{numVertices:o.length,vertices:a,indices:o}}},{key:"createCylinderSharp",value:function(t,e,i){t<4&&(t=4);var n=[],a=[];n[0]=0,n[1]=-i/2,n[2]=0,n[3]=0,n[4]=-1,n[5]=0,n[6]=.5,n[7]=.5;for(var o=Math.PI,r=-o,s=0,c=7,h=0;h<t;++h)n[++c]=e*Math.sin(s),n[++c]=-i/2,n[++c]=e*Math.cos(s),n[++c]=0,n[++c]=-1,n[++c]=0,n[++c]=.5*Math.cos(s)+.5,n[++c]=.5*Math.sin(s+o)+.5,s+=2*o/t;s=0;for(var l=0;l<2;++l){for(var u=Math.cos(r),m=0;m<t;++m){var v=s+2*o/t;n[++c]=e*Math.sin(s),n[++c]=i/2*u,n[++c]=e*Math.cos(s),n[++c]=Math.sin(s)+Math.sin(v),n[++c]=u+u,n[++c]=Math.cos(s)+Math.cos(v),n[++c]=s/(2*o),n[++c]=Math.abs(.5*u-.5),n[++c]=e*Math.sin(v),n[++c]=i/2*u,n[++c]=e*Math.cos(v),n[++c]=Math.sin(s)+Math.sin(v),n[++c]=u+u,n[++c]=Math.cos(s)+Math.cos(v),n[++c]=v/(2*o),n[++c]=Math.abs(.5*u-.5),s=v}n[c-1]=1,s=0,r+=o/1}s=0;for(var f=0;f<t;++f)n[++c]=e*Math.sin(s),n[++c]=i/2,n[++c]=e*Math.cos(s),n[++c]=0,n[++c]=1,n[++c]=0,n[++c]=.5*Math.cos(s)+.5,n[++c]=.5*Math.sin(s+o)+.5,s+=2*o/t;n[++c]=0,n[++c]=i/2,n[++c]=0,n[++c]=0,n[++c]=1,n[++c]=0,n[++c]=.5,n[++c]=.5,c=-1;for(var d=0;d<t;++d)a[++c]=0,a[++c]=d+2<=t?d+2:d+2-t,a[++c]=d+1;for(var g=t+1,p=0;p<1;p++)for(var y=0;y<t;++y)a[++c]=g,a[++c]=g+1,a[++c]=2*t+g,a[++c]=g+1,a[++c]=2*t+g+1,a[++c]=2*t+g,g+=2;for(var x=6*t+2-1,w=0;w<t;++w)a[++c]=x,a[++c]=x-2-w>=x-t?x-2-w:x-1,a[++c]=x-1-w;return{numVertices:a.length,vertices:n,indices:a}}},{key:"createPlane",value:function(t,e){var i,n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=[-t/2,0,-e/2,0,1,0,0,0,t/2,0,-e/2,0,1,0,i=a>1e-4?t/a:1,0,t/2,0,e/2,0,1,0,i,n=o>1e-4?e/o:1,-t/2,0,e/2,0,1,0,0,n],s=[0,2,1,0,3,2],c=4,h=2,l=8;console.log("Vertices before: "+c*l);var u=[];console.log("Vertices before: "+3*h);for(var m=[],v=0;v<c*l;++v)u[v]=r[v];for(var f=0;f<3*h;++f)m[f]=s[f];return{numVertices:c,vertices:u,indices:m}}}]),t}(),C=function(){function t(e){Object(s.a)(this,t),this.gl=e,this.totalVertices=0,this.color=[.5,.5,.5],this.drawMode=this.gl.TRIANGLES,this.transform=new b}return Object(c.a)(t,[{key:"setDrawMode",value:function(t){this.drawMode=t}},{key:"setColor",value:function(t){this.color=t}},{key:"setPosition",value:function(t){this.transform.setPosition(t)}},{key:"setScale",value:function(t){this.transform.setScale(t)}},{key:"setRotation",value:function(t){this.transform.setRotation(t)}},{key:"render",value:function(t){this.shape?(t.activate(),this.bindBuffersAndEnableAttributes(t),this.updateUniforms(t),this.gl.drawElements(this.drawMode,this.totalVertices,this.gl.UNSIGNED_SHORT,0),this.unbindBuffers()):console.log("ERROR! The mesh got no shape!")}},{key:"updateUniforms",value:function(t){this.gl.uniformMatrix4fv(t.modelViewUniformLocation,this.gl.FALSE,this.transform.matrix),this.gl.uniform3fv(t.colorUniformLocation,this.color)}},{key:"unbindBuffers",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}},{key:"bindBuffersAndEnableAttributes",value:function(t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(t.positionAttributeLocation,3,this.gl.FLOAT,this.gl.FALSE,8*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(t.positionAttributeLocation),this.gl.vertexAttribPointer(t.normalAttributeLocation,3,this.gl.FLOAT,this.gl.TRUE,8*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(t.normalAttributeLocation),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer)}},{key:"createBuffers",value:function(t,e){this.vertexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.indexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}},{key:"createCylinderSmooth",value:function(t,e,i,n){this.shape="cylinder";var a=E.createCylinderSmooth(t,e,i,n);this.totalVertices=a.numVertices,this.vertexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(a.vertices),this.gl.STATIC_DRAW),this.indexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a.indices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}},{key:"createCylinderSharp",value:function(t,e,i){this.shape="cylinder";var n=E.createCylinderSharp(t,e,i);this.totalVertices=n.numVertices,this.createBuffers(n.vertices,n.indices)}},{key:"createSphere",value:function(t){this.shape="sphere";var e=E.createSphere(t,1);this.totalVertices=e.numVertices,this.createBuffers(e.vertices,e.indices)}},{key:"createCube",value:function(){this.shape="cube";var t=E.createCube();this.totalVertices=t.numVertices,this.createBuffers(t.vertices,t.indices)}},{key:"createPlane",value:function(t,e){this.shape="plane";for(var i=0,n=0,a=[],o=0;o<=e;++o){n=-t/2;for(var r=0;r<=t;++r)a[i]=n,a[i+1]=0,a[i+2]=-o,a[i+3]=0,a[i+4]=1,a[i+5]=0,a[i+6]=0,a[i+7]=0,++n,i+=8}var s=0,c=1,h=t+2,l=t+1;i=0;for(var u=[],m=0;m<e;++m){for(var v=0;v<t;++v)u[i]=s,u[i+1]=c,u[i+2]=h,u[i+3]=h,u[i+4]=l,u[i+5]=s,++s,++c,++h,++l,i+=6;++s,++c,++h,++l}this.totalVertices=u.length,this.createBuffers(a,u)}},{key:"createLine",value:function(t,e){this.shape="LINE",this.totalVertices=e.length,this.createBuffers(t,e)}}]),t}(),M=function(t){function e(t){var i;return Object(s.a)(this,e),(i=Object(h.a)(this,Object(l.a)(e).call(this,t))).lightColor=new x([1,1,1]),i.attenuationConstants={kLinear:.014,kQuadratic:7e-4},i}return Object(u.a)(e,t),Object(c.a)(e,[{key:"setLightColor",value:function(t){this.lightColor.set(t)}},{key:"setAttenuation",value:function(t,e){this.attenuationConstants={kLinear:t,kQuadratic:e}}}]),e}(L),T=function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,null,[{key:"init",value:function(){this.items=new Map,this.signalPending=!1,this.message=""}},{key:"registerItem",value:function(t,e){this.items.set(t,e)}},{key:"setItemValue",value:function(t,e){this.items.set(t,e)}},{key:"getItemValue",value:function(t){return this.items.get(t)}},{key:"sendSignal",value:function(t){this.signalPending=!0,this.message=t}},{key:"resetSignal",value:function(){this.signalPending=!1,this.message=""}}]),t}(),S=function(){function t(e,i,n){Object(s.a)(this,t),this.canvas=e,this.gl=this.canvas.getContext("webgl");var a=this.createShaderFromFile(this.gl.VERTEX_SHADER,i),o=this.createShaderFromFile(this.gl.FRAGMENT_SHADER,n);this.program=this.createProgramFromShaders(a,o),this.gl.validateProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.VALIDATE_STATUS)||console.error("ERROR validating program!",this.gl.getProgramInfoLog(this.program)),this.gl.useProgram(this.program),this.fetchAttributeLocations(),this.fetchUniformLocations()}return Object(c.a)(t,[{key:"activate",value:function(){this.gl.useProgram(this.program)}},{key:"fetchAttributeLocations",value:function(){this.positionAttributeLocation=this.gl.getAttribLocation(this.program,"vertPosition"),this.normalAttributeLocation=this.gl.getAttribLocation(this.program,"vertNormal"),this.textureAttributeLocation=this.gl.getAttribLocation(this.program,"vertTexCoord")}},{key:"fetchUniformLocations",value:function(){this.modelViewUniformLocation=this.gl.getUniformLocation(this.program,"modelView"),this.cameraViewUniformLocation=this.gl.getUniformLocation(this.program,"cameraView"),this.projectionMatrixUniformLocation=this.gl.getUniformLocation(this.program,"perspective"),this.colorUniformLocation=this.gl.getUniformLocation(this.program,"diffuseColor"),this.viewPositionUniformLocation=this.gl.getUniformLocation(this.program,"viewPosition")}},{key:"createShaderFromFile",value:function(t,e){var i=this.gl.createShader(t);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))return i;console.error("ERROR compiling shader!",this.gl.getShaderInfoLog(i)),this.gl.deleteShader(i)}},{key:"createProgramFromShaders",value:function(t,e){var i=this.gl.createProgram();if(this.gl.attachShader(i,t),this.gl.attachShader(i,e),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS))return i;console.error("ERROR linking program!",this.gl.getProgramInfoLog(i)),this.gl.deleteProgram(i)}},{key:"setProjectionUniform",value:function(t){this.gl.uniformMatrix4fv(this.projectionMatrixUniformLocation,this.gl.FALSE,t)}},{key:"setCameraViewUniform",value:function(t){this.gl.uniformMatrix4fv(this.cameraViewUniformLocation,this.gl.FALSE,t)}},{key:"setCameraViewPosition",value:function(t){this.gl.uniform3fv(this.viewPositionUniformLocation,[t.x,t.y,t.z])}},{key:"getUniformLoc",value:function(t){return this.gl.getUniformLocation(this.program,t)}},{key:"setUniformVec3f",value:function(t,e){this.gl.uniform3fv(t,[e.x,e.y,e.z])}},{key:"setUniformVec2f",value:function(t,e){this.gl.uniform2fv(t,[e[0],e[1]])}},{key:"setUniformMat4f",value:function(t,e){this.gl.uniformMatrix4fv(t,this.gl.FALSE,e)}},{key:"setUniformFloatArray",value:function(t,e){this.gl.uniform1fv(t,e)}},{key:"setUniformVec3Array",value:function(t,e){this.gl.uniform3fv(t,e)}},{key:"setUniformInt",value:function(t,e){this.gl.uniform1i(t,e)}},{key:"setUniformFloat",value:function(t,e){this.gl.uniform1f(t,e)}}]),t}(),R=function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,null,[{key:"vertex",get:function(){return["precision highp float;","attribute vec3 vertPosition;","attribute vec3 vertNormal;","attribute vec2 vertTexCoord;","uniform mat4 cameraView;","uniform mat4 modelView;","uniform mat4 perspective;","varying vec2 TexCoords;","varying vec3 Normal;","varying vec3 FragPosition;","void main() {","mat4 T = perspective * cameraView * modelView;","gl_Position = T * vec4(vertPosition, 1.0);","Normal = normalize(mat3(modelView)*vertNormal);","TexCoords = vertTexCoord;","FragPosition = vec3(modelView * vec4(vertPosition, 1.0));","}"].join("\n")}},{key:"fragment",get:function(){return["precision highp float;","varying vec2 TexCoords;","varying vec3 Normal;","varying vec3 FragPosition;","struct PointLight {","vec3 position;","vec3 color;","vec2 attenuationConstants;","};","uniform vec3 viewPosition;","uniform vec3 diffuseColor;","uniform int lightCount;","uniform PointLight pointLights[10];","vec3 computeSpecularLight(vec3 viewDirection, vec3 reflectDirection, vec3 lightColor) {","float specularStrength = 0.5;","float shininess = 32.0;","float spec = pow(max(dot(viewDirection, reflectDirection), 0.0), shininess);","return spec * specularStrength * lightColor;","}","float computeLightAttenuation(vec3 lightPosition, vec2 attenuationConstants) {","float dist = distance(lightPosition, FragPosition);","return min(1.0 / (1.0 + dist*attenuationConstants.x + dist*dist*attenuationConstants.y), 1.0);","}","vec3 computeDiffuseSpecular(PointLight pointLight, vec3 viewDirection) {","vec3 lightDirection = normalize(pointLight.position - FragPosition);","float diff = max(dot(Normal, lightDirection), 0.0);","vec3 diffuse = (diff * pointLight.color * diffuseColor);","vec3 reflectDirection = reflect(-lightDirection, Normal);","vec3 specular = computeSpecularLight(viewDirection, reflectDirection, pointLight.color) * diff;","float attenuation = computeLightAttenuation(pointLight.position, pointLight.attenuationConstants);","return (diffuse + specular) * attenuation;","}","","void main() {","float ambientStrength = 0.05;","vec3 ambientColor = vec3(1.0, 1.0, 1.0);","vec3 ambient = ambientStrength * ambientColor * diffuseColor;","vec3 phong = ambient;","vec3 viewDirection = normalize(viewPosition - FragPosition);","for(int i = 0; i < 10; i++) {","if (i > lightCount) break;","phong += computeDiffuseSpecular(pointLights[i], viewDirection);","}","gl_FragColor = vec4 (phong, 1.0);","}"].join("\n")}}]),t}(),z=function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,null,[{key:"vertex",get:function(){return["precision mediump float;","attribute vec3 vertPosition;","attribute vec3 vertNormal;","attribute vec2 vertTexCoord;","uniform mat4 cameraView;","uniform mat4 modelView;","uniform mat4 perspective;","varying vec3 Normal;","void main() {","Normal = normalize(mat3(modelView)*vertNormal);","mat4 T = perspective * cameraView * modelView;","gl_Position = T * vec4(vertPosition, 1.0);","}"].join("\n")}},{key:"fragment",get:function(){return["precision mediump float;","varying vec3 Normal;","uniform vec3 viewPosition;","uniform vec3 diffuseColor;","void main() {","gl_FragColor = vec4 (diffuseColor, 1.0);","}"].join("\n")}}]),t}(),A=function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,null,[{key:"perlinNoise",get:function(){return["vec3 mod289(vec3 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 mod289(vec4 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 permute(vec4 x) {","return mod289(((x*34.0)+1.0)*x);","}","vec4 taylorInvSqrt(vec4 r) {","return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise(vec3 v) {","const vec2  C = vec2(1.0/6.0, 1.0/3.0);","const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","vec3 i  = floor(v + dot(v, C.yyy) );","vec3 x0 =   v - i + dot(i, C.xxx) ;","vec3 g = step(x0.yzx, x0.xyz);","vec3 l = 1.0 - g;","vec3 i1 = min( g.xyz, l.zxy );","vec3 i2 = max( g.xyz, l.zxy );","vec3 x1 = x0 - i1 + C.xxx;","vec3 x2 = x0 - i2 + C.yyy;","vec3 x3 = x0 - D.yyy;","i = mod289(i);","vec4 p = permute( permute( permute(","i.z + vec4(0.0, i1.z, i2.z, 1.0 ))","+ i.y + vec4(0.0, i1.y, i2.y, 1.0 ))","+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","float n_ = 0.142857142857; // 1.0/7.0","vec3  ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor(p * ns.z * ns.z);","vec4 x_ = floor(j * ns.z);","vec4 y_ = floor(j - 7.0 * x_ );","vec4 x = x_ *ns.x + ns.yyyy;","vec4 y = y_ *ns.x + ns.yyyy;","vec4 h = 1.0 - abs(x) - abs(y);","vec4 b0 = vec4( x.xy, y.xy );","vec4 b1 = vec4( x.zw, y.zw );","vec4 s0 = floor(b0)*2.0 + 1.0;","vec4 s1 = floor(b1)*2.0 + 1.0;","vec4 sh = -step(h, vec4(0.0));","vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;","vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;","vec3 p0 = vec3(a0.xy,h.x);","vec3 p1 = vec3(a0.zw,h.y);","vec3 p2 = vec3(a1.xy,h.z);","vec3 p3 = vec3(a1.zw,h.w);","vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","m = m * m;","return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),","dot(p2,x2), dot(p3,x3) ) );","}","float sdnoise(vec3 v, out vec3 gradient) {","const vec2  C = vec2(1.0/6.0, 1.0/3.0);","const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","vec3 i  = floor(v + dot(v, C.yyy) );","vec3 x0 =   v - i + dot(i, C.xxx) ;","vec3 g = step(x0.yzx, x0.xyz);","vec3 l = 1.0 - g;","vec3 i1 = min( g.xyz, l.zxy );","vec3 i2 = max( g.xyz, l.zxy );","vec3 x1 = x0 - i1 + C.xxx;","vec3 x2 = x0 - i2 + C.yyy;","vec3 x3 = x0 - D.yyy;","i = mod289(i);","vec4 p = permute( permute( permute(","i.z + vec4(0.0, i1.z, i2.z, 1.0 ))","+ i.y + vec4(0.0, i1.y, i2.y, 1.0 ))","+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","float n_ = 0.142857142857;","vec3  ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor(p * ns.z * ns.z);","vec4 x_ = floor(j * ns.z);","vec4 y_ = floor(j - 7.0 * x_ );","vec4 x = x_ *ns.x + ns.yyyy;","vec4 y = y_ *ns.x + ns.yyyy;","vec4 h = 1.0 - abs(x) - abs(y);","vec4 b0 = vec4( x.xy, y.xy );","vec4 b1 = vec4( x.zw, y.zw );","vec4 s0 = floor(b0)*2.0 + 1.0;","vec4 s1 = floor(b1)*2.0 + 1.0;","vec4 sh = -step(h, vec4(0.0));","vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;","vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;","vec3 p0 = vec3(a0.xy,h.x);","vec3 p1 = vec3(a0.zw,h.y);","vec3 p2 = vec3(a1.xy,h.z);","vec3 p3 = vec3(a1.zw,h.w);","vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","vec4 m2 = m * m;","vec4 m4 = m2 * m2;","vec4 pdotx = vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3));","vec4 temp = m2 * m * pdotx;","gradient = -8.0 * (temp.x * x0 + temp.y * x1 + temp.z * x2 + temp.w * x3);","gradient += m4.x * p0 + m4.y * p1 + m4.z * p2 + m4.w * p3;","gradient *= 42.0;","return 42.0 * dot(m4, pdotx);","}"].join("\n")}},{key:"vertex",get:function(){return["precision highp float;","attribute vec3 vertPosition;","attribute vec3 vertNormal;","attribute vec2 vertTexCoord;","uniform mat4 cameraView;","uniform mat4 modelView;","uniform mat4 perspective;","uniform float time;","uniform float harmonicAmplitude;","uniform float harmonicWaveLength;","uniform float harmonicSpeed;","uniform float waveSharpness;","uniform float harmonicDirectionAngle;","varying vec2 TexCoords;","varying vec3 Normal;","varying vec3 FragPosition;","varying float Time;",this.perlinNoise,"void main() {","vec4 worldPos = modelView*vec4(vertPosition, 1.0);","vec2 direction = vec2(sin(harmonicDirectionAngle), cos(harmonicDirectionAngle));","vec2 xzRotated = vec2(worldPos.x*direction.x, worldPos.z*direction.y);","float harmonicFrequency = 6.28318530718/harmonicWaveLength;","float harmonicPhase = harmonicSpeed * harmonicFrequency;","float theta = (xzRotated.x + xzRotated.y)*harmonicFrequency + harmonicPhase*time;","float harmonicWave = 2.0*harmonicAmplitude*pow((sin(theta) + 1.0)/2.0, waveSharpness);","float waveNoise = 5.0*snoise(0.005*vec3(worldPos.xz, 10.0*time));","waveNoise += 0.25*snoise(0.1*vec3(worldPos.xz, 4.0*time));","float waveFunction = harmonicWave + waveNoise;","vec3 displacedPosition = vec3(vertPosition.x, vertPosition.y + waveFunction, vertPosition.z);","float A = waveSharpness*harmonicFrequency*harmonicAmplitude;","float B = pow((sin(theta) + 1.0)/2.0, waveSharpness - 1.0);","float C = cos(theta);","float partialDerivativeX = direction.x*A*B*C;","float partialDerivativeZ = direction.y*A*B*C;","vec3 displacedNormal = normalize(vec3(-partialDerivativeX, 1.0, -partialDerivativeZ));","Normal = normalize(mat3(modelView)*displacedNormal);","vertNormal;","mat4 T = perspective * cameraView * modelView;","gl_Position = T * vec4(displacedPosition, 1.0);","TexCoords = vertTexCoord;","FragPosition = vec3(modelView * vec4(displacedPosition, 1.0));","Time = time;","}"].join("\n")}},{key:"fragment",get:function(){return["","#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives : enable","#endif","#ifdef GL_ES","precision highp float;","#endif","varying vec2 TexCoords;","varying vec3 Normal;","varying vec3 FragPosition;","varying float Time;","struct PointLight {","vec3 position;","vec3 color;","vec2 attenuationConstants;","};","uniform vec3 viewPosition;","uniform vec3 diffuseColor;","uniform int lightCount;","uniform PointLight pointLights[10];","vec3 computeSpecularLight(vec3 viewDirection, vec3 reflectDirection, vec3 lightColor) {","float specularStrength = 1.0;","float shininess = 96.0;","float spec = pow(max(dot(viewDirection, reflectDirection), 0.0), shininess);","return spec * specularStrength * lightColor;","}","float computeLightAttenuation(vec3 lightPosition, vec2 attenuationConstants) {","float dist = distance(lightPosition, FragPosition);","return min(1.0 / (1.0 + dist*attenuationConstants.x + dist*dist*attenuationConstants.y), 1.0);","}","vec3 computeDiffuseSpecular(PointLight pointLight, vec3 viewDirection, vec3 normal) {","vec3 lightDirection = normalize(pointLight.position - FragPosition);","float diff = max(dot(normal, lightDirection), 0.0);","vec3 diffuse = (diff * pointLight.color * diffuseColor);","vec3 reflectDirection = reflect(-lightDirection, normal);","vec3 specular = computeSpecularLight(viewDirection, reflectDirection, pointLight.color) * diff;","float attenuation = computeLightAttenuation(pointLight.position, pointLight.attenuationConstants);","return (diffuse + specular) * attenuation;","}",this.perlinNoise,"void main() {","float baseSpeed = 2.0;","float baseFrequency = 0.5;","vec3 gradient1 = vec3(0.0);","float noise = sdnoise(baseFrequency*vec3(FragPosition.xz, Time*baseSpeed), gradient1);","vec3 gradient2 = vec3(0.0);","noise += 0.25*sdnoise(4.0*baseFrequency*vec3(FragPosition.xz, 0.25*Time*baseSpeed), gradient2);","vec3 gradient3 = vec3(0.0);","noise += 0.125*sdnoise(8.0*baseFrequency*vec3(FragPosition.xz, 0.125*Time*baseSpeed), gradient3);","vec3 gradient4 = vec3(0.0);","noise += 0.0625*sdnoise(16.0*baseFrequency*vec3(FragPosition.xz, 0.0625*Time*baseSpeed), gradient4);","float bumpStrength = 0.05;","vec3 bumb = normalize(0.5*gradient1 + mix(mix(gradient2, gradient3, 0.5), gradient4, 0.5));","vec3 bumpedNormal = normalize(vec3(Normal + bumpStrength*bumb));","float ambientStrength = 0.1;","vec3 ambientColor = vec3(1.0, 1.0, 1.0);","vec3 ambient = ambientStrength * ambientColor * diffuseColor;","vec3 viewDirection = normalize(viewPosition - FragPosition);","vec3 phong = ambient;","for(int i = 0; i < 10; i++) {","if (i > lightCount) break;","phong += computeDiffuseSpecular(pointLights[i], viewDirection, bumpedNormal);","}","gl_FragColor = vec4 (phong, 1.0);","}"].join("\n")}}]),t}(),F=[90,34,-90],j=[-15,140,0],O=0,B=1,U=2,D=3,V=4,_=Math.PI/3,I=function(){function t(){Object(s.a)(this,t),this.scenes=[],this.shaders=new Map,this.viewportAspectRatio=1,this.lag=0}return Object(c.a)(t,[{key:"run",value:function(){for(m.update(),this.processInputEvents(),this.processInternalSignals(),this.lag+=m.deltaTime;this.lag>=4;)this.update(),y.resetMouseEvents(),this.lag-=4;this.render(this.lag/4)}},{key:"update",value:function(){this.scenes.forEach((function(t){t.update(.01)})),this.camera.updateUniforms()}},{key:"render",value:function(t){this.updateViewportDimensions(),this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT),this.gl.enable(this.gl.DEPTH_TEST),this.scenes.forEach((function(t){t.draw()})),this.editor.render(this.scenes)}},{key:"processInputEvents",value:function(){this.editor.processUserInput()}},{key:"processInternalSignals",value:function(){T.signalPending&&(this.updateWaveParameter(T.message),T.resetSignal())}},{key:"preload",value:function(){m.init(),y.init(),this.setUpWebGL();var t=new S(this.canvas,R.vertex,R.fragment),e=new S(this.canvas,z.vertex,z.fragment),i=new S(this.canvas,A.vertex,A.fragment);this.shaders.set("phong",t),this.shaders.set("ambient",e),this.shaders.set("procedural",i),this.camera=new P(this.shaders),this.camera.setPosition(F),this.camera.setRotation(j),this.editor=new f(this.gl,this.context2D,this.shaders,this.camera,this.canvas),this.fieldOfView=_,this.viewportAspectRatio=this.canvas.width/this.canvas.height,this.refreshProjectionMatrix(),this.setUpScene()}},{key:"setUpScene",value:function(){var t=new k(this.shaders);this.loadDefaultScene(t),this.scenes.push(t)}},{key:"updateViewportDimensions",value:function(){var t=this.canvas.width/this.canvas.height;Math.abs(this.viewportAspectRatio-t)<.001||(this.viewportAspectRatio=t,this.refreshProjectionMatrix(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height))}},{key:"createGameObject",value:function(t){var e=new C(this.gl);t.shape===O?e.createCube():t.shape===B?e.createSphere(32):t.shape===U?e.createCylinderSmooth(32,1,1,2):t.shape===D?e.createCylinderSharp(8,1,2):t.shape===V&&e.createPlane(200,200),e.setColor(t.color);var i=new L(t.name);return i.setPosition(t.position),i.setScale(t.scale),i.addMesh(e),i.setShader(t.shader),i}},{key:"createPointLightSource",value:function(t){var e=new M(t.name);e.setPosition(t.position),e.setScale(t.scale),e.setLightColor(t.color),e.setAttenuation(t.attenuation.kLinear,t.attenuation.kQuadratic);var i=new C(this.gl);return i.createSphere(8),i.setColor(t.color),e.addMesh(i),e}},{key:"loadDefaultScene",value:function(t){this.updateWaveParameter("harmonicAmplitude"),this.updateWaveParameter("harmonicWaveLength"),this.updateWaveParameter("harmonicSpeed"),this.updateWaveParameter("waveSharpness"),this.updateWaveParameter("harmonicDirectionAngle");var e=T.getItemValue("waterColor"),i=this.createGameObject({shape:V,name:"Waves",scale:[1,1,1],position:[0,10,100],color:[e.r,e.g,e.b],shader:"procedural"});t.addGameObject(i),this.water=[],this.water.push(i);t.addGameObject(this.createGameObject({shape:O,name:"Floor",scale:[100,.1,100],position:[0,-.1,0],color:[.75,.75,.75],shader:"phong"}));var n=[1,1,1];t.addGameObject(this.createGameObject({shape:O,name:"Left Wall",scale:[.1,20,100],position:[-100,20,0],color:n,shader:"phong"})),t.addGameObject(this.createGameObject({shape:O,name:"Right Wall",scale:[.1,20,100],position:[100,20,0],color:n,shader:"phong"})),t.addGameObject(this.createGameObject({shape:O,name:"Back Wall",scale:[100,20,.1],position:[0,20,-100],color:n,shader:"phong"})),t.addGameObject(this.createGameObject({shape:O,name:"Front Wall",scale:[100,20,.1],position:[0,20,100],color:n,shader:"phong"}));var a={kLinear:.014,kQuadratic:7e-4};t.addLightSource(this.createPointLightSource({name:"Middle Lamp",scale:[1,1,1],position:[0,39,-75],color:[1,1,1],attenuation:a})),t.addLightSource(this.createPointLightSource({name:"Right Lamp",scale:[1,1,1],position:[75,39,-75],color:[1,1,1],attenuation:a})),t.addLightSource(this.createPointLightSource({name:"Left Lamp",scale:[1,1,1],position:[-75,39,-75],color:[1,1,1],attenuation:a})),t.addLightSource(this.createPointLightSource({name:"Middle Lamp",scale:[1,1,1],position:[0,39,75],color:[1,1,1],attenuation:a})),t.addLightSource(this.createPointLightSource({name:"Right Lamp",scale:[1,1,1],position:[75,39,75],color:[1,1,1],attenuation:a})),t.addLightSource(this.createPointLightSource({name:"Left Lamp",scale:[1,1,1],position:[-75,39,75],color:[1,1,1],attenuation:a})),t.addLightSource(this.createPointLightSource({name:"Middle Left Lamp",scale:[1,1,1],position:[-75,39,0],color:[1,1,1],attenuation:a})),t.addLightSource(this.createPointLightSource({name:"Middle Right Lamp",scale:[1,1,1],position:[75,39,0],color:[1,1,1],attenuation:a})),t.addLightSource(this.createPointLightSource({name:"Middle Lamp",scale:[1,1,1],position:[0,39,0],color:[1,1,1],attenuation:a}))}},{key:"setUpWebGL",value:function(){if(this.context2D=document.getElementById("text-canvas").getContext("2d"),this.canvas=document.getElementById("gl-canvas"),this.gl=this.canvas.getContext("webgl"),!this.gl)return console.log("WebGL is not supported"),alert("Unable to initialize WebGL. Your browser or machine may not support it."),0;this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(.02,.02,.02,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.frontFace(this.gl.CCW)}},{key:"refreshProjectionMatrix",value:function(){var t=this;this.projectionMatrix=w.perspective(this.fieldOfView,this.viewportAspectRatio,.1,1e4),this.editor.projectionMatrix=this.projectionMatrix,this.shaders.forEach((function(e){e.activate(),e.setProjectionUniform(t.projectionMatrix)}))}},{key:"updateWaveParameter",value:function(t){var e=T.getItemValue(t);if("waterColor"===t)this.water.forEach((function(t){t.meshes[0].setColor([e.r,e.g,e.b])}));else{var i=this.shaders.get("procedural");i.activate();var n=i.getUniformLoc(t);i.setUniformFloat(n,e)}}}]),t}(),N=function(t){function e(t){var i;return Object(s.a)(this,e),(i=Object(h.a)(this,Object(l.a)(e).call(this,t))).state={canvasWidth:100,canvasHeight:100},i.animationId=null,i.engine=new I,i}return Object(u.a)(e,t),Object(c.a)(e,[{key:"resizeCanvas",value:function(){this.setState({canvasWidth:this.engineWindowContainer.offsetWidth,canvasHeight:this.engineWindowContainer.offsetHeight})}},{key:"componentDidMount",value:function(){this.engineWindowContainer=document.getElementById("canvas-container"),window.addEventListener("resize",this.resizeCanvas.bind(this)),this.startMainLoop()}},{key:"componentWillUnmount",value:function(){this.stopMainLoop(),window.removeEventListener("resize",this.resizeCanvas.bind(this))}},{key:"startMainLoop",value:function(){this.engine.preload(),this.resizeCanvas(),this.animationId=window.requestAnimationFrame(this.mainLoop.bind(this))}},{key:"stopMainLoop",value:function(){window.cancelAnimationFrame(this.animationId),this.animationId=null}},{key:"mainLoop",value:function(){this.animationId=window.requestAnimationFrame(this.mainLoop.bind(this)),this.engine.run()}},{key:"render",value:function(){var t={width:this.state.canvasWidth,height:this.state.canvasHeight};return a.a.createElement("div",{id:"canvas-container"},a.a.createElement("canvas",{style:t,id:"gl-canvas",width:this.state.canvasWidth,height:this.state.canvasHeight},"Your browser does not support HTML5"),a.a.createElement("canvas",{style:t,id:"text-canvas",width:this.state.canvasWidth,height:this.state.canvasHeight}))}}]),e}(n.Component),W=function(t){function e(){return Object(s.a)(this,e),Object(h.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(c.a)(e,[{key:"setNewValue",value:function(t){var e;t===this.props.colorTag?e={r:this.clamp(parseFloat(document.getElementById("r-color").value)/255,0,1),g:this.clamp(parseFloat(document.getElementById("g-color").value)/255,0,1),b:this.clamp(parseFloat(document.getElementById("b-color").value)/255,0,1)}:e=parseFloat(document.getElementById(t).value);T.setItemValue(t,e),T.sendSignal(t)}},{key:"handleKeyPress",value:function(t,e){13===e.charCode&&document.getElementById(t).click()}},{key:"clamp",value:function(t,e,i){return t>i?i:t<e?e:t}},{key:"render",value:function(){var t={backgroundColor:"#2a2d38",width:this.props.width,textAlign:"center",overflow:"auto"},e={color:"white",fontSize:"1.0em"},i={marginLeft:10,width:40},n={paddingBottom:5},o=function(t,e){return parseInt(t,e)},r=T.getItemValue(this.props.colorTag);return a.a.createElement("div",{id:"side-panel",style:t},a.a.createElement("p",{style:{color:"white",fontSize:"2em"}},"PARAMETERS"),a.a.createElement("div",{style:n},a.a.createElement("p",{style:e},"Amplitude"),a.a.createElement("input",{style:{width:175},id:this.props.amplitudeTag,type:"range",min:"0.0",max:"10.0",step:"0.1",defaultValue:T.getItemValue(this.props.amplitudeTag),onChange:this.setNewValue.bind(this,this.props.amplitudeTag)})),a.a.createElement("div",{style:n},a.a.createElement("p",{style:e},"Wave Length"),a.a.createElement("input",{style:{width:175},id:this.props.waveLengthTag,type:"range",min:"15.0",max:"300.0",step:"1.0",defaultValue:T.getItemValue(this.props.waveLengthTag),onChange:this.setNewValue.bind(this,this.props.waveLengthTag)})),a.a.createElement("div",{style:n},a.a.createElement("p",{style:e},"Speed"),a.a.createElement("input",{style:{width:175},id:this.props.speedTag,type:"range",min:"0.0",max:"20.0",step:"0.1",defaultValue:T.getItemValue(this.props.speedTag),onChange:this.setNewValue.bind(this,this.props.speedTag)})),a.a.createElement("div",{style:n},a.a.createElement("p",{style:e},"Sharpness"),a.a.createElement("input",{style:{width:175},id:this.props.sharpnessTag,type:"range",min:"1.0",max:"20.0",step:"0.1",defaultValue:T.getItemValue(this.props.sharpnessTag),onChange:this.setNewValue.bind(this,this.props.sharpnessTag)})),a.a.createElement("div",{style:n},a.a.createElement("p",{style:e},"Direction"),a.a.createElement("input",{style:{width:175},id:this.props.angleTag,type:"range",min:"0.0",max:"6.28318530718",step:"0.06283185307",defaultValue:T.getItemValue(this.props.angleTag),onChange:this.setNewValue.bind(this,this.props.angleTag)})),a.a.createElement("div",{style:n},a.a.createElement("p",{style:e},"Color"),a.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.a.createElement("input",{style:i,id:"r-color",type:"number",step:"1",min:"0",max:"255",onKeyPress:this.handleKeyPress.bind(this,"submit-color"),defaultValue:o(255*r.r)}),a.a.createElement("input",{style:i,id:"g-color",type:"number",step:"1.0",min:"0.0",max:"255.0",onKeyPress:this.handleKeyPress.bind(this,"submit-color"),defaultValue:o(255*r.g)}),a.a.createElement("input",{style:i,id:"b-color",type:"number",step:"1.0",min:"0.0",max:"255.0",onKeyPress:this.handleKeyPress.bind(this,"submit-color"),defaultValue:o(255*r.b)}),a.a.createElement("button",{id:"submit-color",style:{marginLeft:10,marginRight:10,cursor:"pointer"},onClick:this.setNewValue.bind(this,this.props.colorTag)},"Submit"))))}}]),e}(n.Component),Y=(i(16),function(t){function e(){return Object(s.a)(this,e),Object(h.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return a.a.createElement("div",{id:"top-panel",style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#0074ff",color:"white",width:"100%",fontSize:"1.0em"}},a.a.createElement("h1",null,"Procedural Waves Demo"),a.a.createElement("div",{className:"dropdown-container"},a.a.createElement("button",{className:"dropbtn",style:{backgroundColor:"Transparent",color:"white",padding:"1.0em 2.0em 1.0em 2.0em",fontSize:"2.0em",border:"none"}},"Controls"),a.a.createElement("div",{className:"dropdown-content"},a.a.createElement("div",null,a.a.createElement("p",{style:{fontWeight:"bold",margin:0}},"Rotate"),a.a.createElement("p",{style:{marginTop:0}},"Press and hold right mouse button")),a.a.createElement("div",null,a.a.createElement("p",{style:{fontWeight:"bold",margin:0}},"Move Left/Right/Up/Down"),a.a.createElement("p",{style:{marginTop:0}},"Press and hold left mouse button")),a.a.createElement("div",null,a.a.createElement("p",{style:{fontWeight:"bold",margin:0}},"Move Forward/Backwards"),a.a.createElement("p",{style:{marginTop:0}},"Turn ",a.a.createElement("b",null,"or")," Press and hold scroll wheel")))))}}]),e}(n.Component)),G=function(t){function e(t){var i;return Object(s.a)(this,e),(i=Object(h.a)(this,Object(l.a)(e).call(this,t))).state={colorTag:"waterColor",amplitudeTag:"harmonicAmplitude",waveLengthTag:"harmonicWaveLength",sharpnessTag:"waveSharpness",speedTag:"harmonicSpeed",angleTag:"harmonicDirectionAngle"},T.init(),T.registerItem(i.state.colorTag,{r:.1,g:.15,b:.4}),T.registerItem(i.state.amplitudeTag,4),T.registerItem(i.state.waveLengthTag,65),T.registerItem(i.state.sharpnessTag,3),T.registerItem(i.state.speedTag,5),T.registerItem(i.state.angleTag,1.57079632679),i}return Object(u.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return a.a.createElement("div",{className:"App-container"},a.a.createElement(Y,null),a.a.createElement("div",{style:{height:"100%",width:"100%",display:"flex",flexDirection:"row"}},a.a.createElement(W,{width:"300px",colorTag:this.state.colorTag,amplitudeTag:this.state.amplitudeTag,waveLengthTag:this.state.waveLengthTag,sharpnessTag:this.state.sharpnessTag,speedTag:this.state.speedTag,angleTag:this.state.angleTag}),a.a.createElement("div",{id:"engine-window-container"},a.a.createElement(N,null))))}}]),e}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}],[[8,1,2]]]);
//# sourceMappingURL=main.035b8512.chunk.js.map